name: Release

on:
    push:
        tags:
            - "v*"

permissions:
    contents: write

jobs:
    release:
        runs-on: ubuntu-latest
        steps:
            - name: Check out repository
              uses: actions/checkout@v4
              with:
                  fetch-depth: 0

            - name: Generate changelog
              id: changelog
              uses: mikepenz/release-changelog-builder-action@v4
              with:
                  configuration: |
                      {
                        "categories": [
                          {
                            "title": "## üöÄ Features",
                            "labels": ["feat", "feature", "enhancement"]
                          },
                          {
                            "title": "## üêõ Bug Fixes",
                            "labels": ["fix", "bug", "bugfix"]
                          },
                          {
                            "title": "## üìö Documentation",
                            "labels": ["docs", "documentation"]
                          },
                          {
                            "title": "## üîß Maintenance",
                            "labels": ["chore", "ci", "refactor"]
                          }
                        ],
                        "template": "#{{CHANGELOG}}\n\n**Full Changelog**: #{{RELEASE_DIFF}}",
                        "pr_template": "- #{{TITLE}} (#{{NUMBER}})",
                        "empty_template": "No changes since last release."
                      }
              env:
                  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

            - name: Create GitHub Release
              uses: softprops/action-gh-release@v2
              with:
                  body: ${{ steps.changelog.outputs.changelog }}
                  generate_release_notes: true
                  files: |
                      *.vsix
              env:
                  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
